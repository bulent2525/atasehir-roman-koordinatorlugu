<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ataşehir Valilik Roman Koordinatörlüğü</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'turquoise': {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            200: '#99f6e4',
                            300: '#5eead4',
                            400: '#2dd4bf',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                            800: '#115e59',
                            900: '#134e4a'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);
        }
        .dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
        }
        .dark-mode .bg-white {
            background-color: #1e293b !important;
            color: #f8fafc;
        }
        .dark-mode .text-gray-900 {
            color: #f8fafc !important;
        }
        .dark-mode .text-gray-700 {
            color: #cbd5e1 !important;
        }
        .dark-mode .text-gray-600 {
            color: #94a3b8 !important;
        }
        .dark-mode .border-gray-300 {
            border-color: #334155 !important;
        }
        .dark-mode input, .dark-mode textarea, .dark-mode select {
            background-color: #334155 !important;
            color: #f8fafc !important;
            border-color: #475569 !important;
        }
        .dark-mode .bg-indigo-50 {
            background-color: #1e1b4b !important;
            border-color: #312e81 !important;
        }
        .dark-mode .text-indigo-700 {
            color: #c4b5fd !important;
        }
        .dark-mode .text-indigo-900 {
            color: #e0e7ff !important;
        }
        .fixed-notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            transform: translateY(-2px);
        }
        .nav-link.active {
            background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%);
            color: white !important;
        }
        .admin-only {
            display: none;
        }
        .admin-visible {
            display: block !important;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>

    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-turquoise-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-turquoise-600 p-3 rounded-full">
                        <i class="fas fa-map-marker-alt text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-900">
                            Ataşehir Valilik Roman Koordinatörlüğü
                        </h1>
                        <p class="text-gray-600 mt-1">Dezavantajlı Roman Halkı Destek Sistemi</p>
                    </div>
                </div>
                <div class="mt-4 md:mt-0 flex items-center space-x-4">
                    <div class="flex flex-col space-y-2">
                        <div class="flex items-center space-x-2 text-gray-700">
                            <i class="fas fa-phone text-turquoise-600"></i>
                            <span class="font-medium">545 774 27 53</span>
                        </div>
                        <div class="flex items-center space-x-2 text-gray-700">
                            <i class="fas fa-envelope text-turquoise-600"></i>
                            <span class="font-medium">atasehirvalikoordinatoru@gmail.com</span>
                        </div>
                    </div>
                    <button id="themeToggle" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors">
                        <i class="fas fa-moon text-gray-600"></i>
                    </button>
                    <button id="adminLoginBtn" class="p-2 rounded-lg bg-turquoise-100 hover:bg-turquoise-200 transition-colors">
                        <i class="fas fa-lock text-turquoise-600"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Yönetici Girişi</h3>
                <button id="closeLoginModal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="adminLoginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Şifre</label>
                    <input
                        type="password"
                        id="adminPassword"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500"
                        placeholder="Yönetici şifresini girin"
                        required
                    />
                </div>
                <button
                    type="submit"
                    class="w-full bg-turquoise-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-turquoise-700 focus:outline-none focus:ring-2 focus:ring-turquoise-500 focus:ring-offset-2 transition-colors duration-200"
                >
                    Giriş Yap
                </button>
            </form>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-md border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex space-x-8">
                <button class="nav-link py-4 px-2 border-b-2 border-transparent text-gray-700 hover:border-turquoise-500 hover:text-turquoise-600 font-medium" data-tab="form">
                    İhtiyaç Bildirimi
                </button>
                <button class="nav-link py-4 px-2 border-b-2 border-transparent text-gray-700 hover:border-turquoise-500 hover:text-turquoise-600 font-medium admin-only" data-tab="submissions">
                    Başvurular
                </button>
                <button class="nav-link py-4 px-2 border-b-2 border-transparent text-gray-700 hover:border-turquoise-500 hover:text-turquoise-600 font-medium admin-only" data-tab="stats">
                    İstatistikler
                </button>
                <button class="nav-link py-4 px-2 border-b-2 border-transparent text-gray-700 hover:border-turquoise-500 hover:text-turquoise-600 font-medium admin-only" data-tab="management">
                    Veri Yönetimi
                </button>
                <button class="nav-link py-4 px-2 border-b-2 border-transparent text-gray-700 hover:border-turquoise-500 hover:text-turquoise-600 font-medium admin-only" data-tab="reports">
                    Günlük Raporlar
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Success/Error Messages -->
        <div id="successMessage" class="fixed-notification bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 hidden">
            <i class="fas fa-check-circle"></i>
            <span>Başvurunuz başarıyla kaydedildi!</span>
        </div>
        <div id="errorMessage" class="fixed-notification bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 hidden">
            <i class="fas fa-exclamation-circle"></i>
            <span>Lütfen zorunlu alanları doldurun!</span>
        </div>

        <!-- Form Section (Public) -->
        <div id="formSection" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Form Section -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                            <i class="fas fa-user text-turquoise-600 mr-2"></i>
                            İhtiyaç Bildirim Formu
                        </h2>
                        <i class="fas fa-clock text-gray-400"></i>
                    </div>

                    <form id="needsForm" class="space-y-6">
                        <!-- Personal Information -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Ad Soyad *
                                </label>
                                <input
                                    type="text"
                                    name="name"
                                    id="name"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500"
                                    placeholder="Adınızı ve soyadınızı girin"
                                    required
                                />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Telefon *
                                </label>
                                <input
                                    type="tel"
                                    name="phone"
                                    id="phone"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500"
                                    placeholder="555 123 45 67"
                                    required
                                />
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Adres
                                </label>
                                <input
                                    type="text"
                                    name="address"
                                    id="address"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500"
                                    placeholder="Tam adresinizi girin"
                                />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Mahalle
                                </label>
                                <input
                                    type="text"
                                    name="district"
                                    id="district"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500"
                                    placeholder="Mahallenizi girin"
                                />
                            </div>
                        </div>

                        <!-- Needs Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                İhtiyaç Türleri *
                            </label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3" id="needsContainer">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="needs"
                                        value="food"
                                        class="rounded border-gray-300 text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-red-100 text-red-600">
                                        <i class="fas fa-utensils text-sm"></i>
                                        <span class="text-sm font-medium">Gıda</span>
                                    </div>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="needs"
                                        value="health"
                                        class="rounded border-gray-300 text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-green-100 text-green-600">
                                        <i class="fas fa-heartbeat text-sm"></i>
                                        <span class="text-sm font-medium">Sağlık</span>
                                    </div>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="needs"
                                        value="education"
                                        class="rounded border-gray-300 text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-blue-100 text-blue-600">
                                        <i class="fas fa-graduation-cap text-sm"></i>
                                        <span class="text-sm font-medium">Eğitim</span>
                                    </div>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="needs"
                                        value="housing"
                                        class="rounded border-gray-300 text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-purple-100 text-purple-600">
                                        <i class="fas fa-home text-sm"></i>
                                        <span class="text-sm font-medium">Barınma</span>
                                    </div>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="needs"
                                        value="employment"
                                        class="rounded border-gray-300 text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-yellow-100 text-yellow-600">
                                        <i class="fas fa-briefcase text-sm"></i>
                                        <span class="text-sm font-medium">İstihdam</span>
                                    </div>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="needs"
                                        value="legal"
                                        class="rounded border-gray-300 text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-indigo-100 text-indigo-600">
                                        <i class="fas fa-balance-scale text-sm"></i>
                                        <span class="text-sm font-medium">Hukuk</span>
                                    </div>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="checkbox"
                                        name="needs"
                                        value="other"
                                        class="rounded border-gray-300 text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <div class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-100 text-gray-600">
                                        <i class="fas fa-building text-sm"></i>
                                        <span class="text-sm font-medium">Diğer</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div id="otherNeedContainer" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Diğer İhtiyaç
                            </label>
                            <input
                                type="text"
                                name="otherNeed"
                                id="otherNeed"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500"
                                placeholder="Diğer ihtiyaçlarınızı belirtin"
                            />
                        </div>

                        <!-- Urgency -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Aciliyet Durumu
                            </label>
                            <div class="flex space-x-3">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="radio"
                                        name="urgency"
                                        value="normal"
                                        class="text-turquoise-600 focus:ring-turquoise-500"
                                        checked
                                    />
                                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Normal
                                    </span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="radio"
                                        name="urgency"
                                        value="high"
                                        class="text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        Yüksek
                                    </span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input
                                        type="radio"
                                        name="urgency"
                                        value="urgent"
                                        class="text-turquoise-600 focus:ring-turquoise-500"
                                    />
                                    <span class="px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        Acil
                                    </span>
                                </label>
                            </div>
                        </div>

                        <!-- Description -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Detaylı Açıklama
                            </label>
                            <textarea
                                name="description"
                                id="description"
                                rows="4"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500"
                                placeholder="İhtiyaçlarınızı detaylı bir şekilde açıklayın..."
                            ></textarea>
                        </div>

                        <button
                            type="submit"
                            class="w-full bg-turquoise-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-turquoise-700 focus:outline-none focus:ring-2 focus:ring-turquoise-500 focus:ring-offset-2 transition-colors duration-200"
                        >
                            İhtiyacı Bildir
                        </button>
                    </form>
                </div>
            </div>

            <!-- Stats and Export Section (Admin Only) -->
            <div class="space-y-6 admin-only">
                <!-- Stats Card -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">İstatistikler</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Toplam Başvuru</span>
                            <span id="totalSubmissions" class="font-bold text-turquoise-600">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Bugünkü Başvurular</span>
                            <span id="todaySubmissions" class="font-bold text-green-600">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Acil Durumlar</span>
                            <span id="urgentSubmissions" class="font-bold text-red-600">0</span>
                        </div>
                    </div>
                </div>

                <!-- Export Button -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Veri Yönetimi</h3>
                    <button
                        id="exportBtn"
                        class="w-full bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors duration-200 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center space-x-2"
                        disabled
                    >
                        <i class="fas fa-download"></i>
                        <span>Excel Olarak İndir</span>
                    </button>
                    <p class="text-xs text-gray-500 mt-2 text-center">
                        Tüm verileri tek tuşla indirin
                    </p>
                </div>

                <!-- Instructions -->
                <div class="bg-turquoise-50 rounded-xl p-6 border border-turquoise-200">
                    <h3 class="text-lg font-semibold text-turquoise-900 mb-3">Nasıl Kullanılır?</h3>
                    <ul class="space-y-2 text-sm text-turquoise-700">
                        <li class="flex items-start space-x-2">
                            <span class="text-turquoise-600 font-bold">1.</span>
                            <span>İhtiyaçlarınızı formdan bildirin</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <span class="text-turquoise-600 font-bold">2.</span>
                            <span>Koordinatör ekibi başvurunuzu değerlendirecek</span>
                        </li>
                        <li class="flex items-start space-x-2">
                            <span class="text-turquoise-600 font-bold">3.</span>
                            <span>Gün sonu tüm verileri Excel olarak indirin</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Submissions Section (Admin Only) -->
        <div id="submissionsSection" class="hidden admin-only">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                        <i class="fas fa-file-alt text-turquoise-600 mr-2"></i>
                        Tüm Başvurular
                    </h2>
                    <div class="flex items-center space-x-4">
                        <!-- Filter Controls -->
                        <div class="flex space-x-2">
                            <select id="filterUrgency" class="px-3 py-1 border border-gray-300 rounded text-sm">
                                <option value="all">Tüm Aciliyetler</option>
                                <option value="urgent">Acil</option>
                                <option value="high">Yüksek</option>
                                <option value="normal">Normal</option>
                            </select>
                            <select id="filterNeed" class="px-3 py-1 border border-gray-300 rounded text-sm">
                                <option value="all">Tüm İhtiyaçlar</option>
                                <option value="food">Gıda</option>
                                <option value="health">Sağlık</option>
                                <option value="education">Eğitim</option>
                                <option value="housing">Barınma</option>
                                <option value="employment">İstihdam</option>
                                <option value="legal">Hukuk</option>
                                <option value="other">Diğer</option>
                            </select>
                            <button id="applyFilters" class="px-3 py-1 bg-turquoise-600 text-white rounded text-sm hover:bg-turquoise-700">
                                <i class="fas fa-filter mr-1"></i>Filtrele
                            </button>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-gray-600">Toplam: <span id="submissionsCount" class="font-bold">0</span></span>
                            <button id="refreshSubmissions" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors">
                                <i class="fas fa-sync-alt text-gray-600"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="submissionsList" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- Submissions will be populated here -->
                </div>
                
                <div id="noSubmissions" class="text-center py-8 text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-4 text-gray-300"></i>
                    <p>Henüz hiçbir başvuru bulunmamaktadır.</p>
                </div>
            </div>
        </div>

        <!-- Stats Section (Admin Only) -->
        <div id="statsSection" class="hidden admin-only">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-chart-bar text-turquoise-600 mr-2"></i>
                    Detaylı İstatistikler
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-medium text-gray-900 mb-2">İhtiyaç Dağılımı</h3>
                        <div id="needsDistribution" class="space-y-2">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-medium text-gray-900 mb-2">Aciliyet Dağılımı</h3>
                        <div id="urgencyDistribution" class="space-y-2">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h3 class="font-medium text-gray-900 mb-2">Günlük Başvurular</h3>
                        <div id="dailySubmissions" class="space-y-2">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Management Section (Admin Only) -->
        <div id="managementSection" class="hidden admin-only">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-database text-turquoise-600 mr-2"></i>
                    Veri Yönetimi
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border border-gray-200 rounded-lg p-6">
                        <h3 class="font-medium text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-download text-green-600 mr-2"></i>
                            Veri İndirme
                        </h3>
                        <button
                            id="exportBtnManagement"
                            class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors duration-200 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center space-x-2"
                            disabled
                        >
                            <i class="fas fa-file-excel"></i>
                            <span>Tüm Verileri İndir (.CSV)</span>
                        </button>
                        <p class="text-xs text-gray-500 mt-2 text-center">
                            Tüm başvuru verilerini Excel formatında indirin
                        </p>
                    </div>
                    
                    <div class="border border-gray-200 rounded-lg p-6">
                        <h3 class="font-medium text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-trash-alt text-red-600 mr-2"></i>
                            Veri Temizleme
                        </h3>
                        <button
                            id="clearDataBtn"
                            class="w-full bg-red-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors duration-200 flex items-center justify-center space-x-2"
                        >
                            <i class="fas fa-eraser"></i>
                            <span>Tüm Verileri Sil</span>
                        </button>
                        <p class="text-xs text-gray-500 mt-2 text-center">
                            Tüm başvuru kayıtlarını kalıcı olarak siler
                        </p>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <h4 class="font-medium text-yellow-800 mb-2 flex items-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Dikkat!
                    </h4>
                    <p class="text-sm text-yellow-700">
                        Veri temizleme işlemi geri alınamaz. Lütfen verileri indirdikten sonra temizleme işlemi yapın.
                    </p>
                </div>
            </div>
        </div>

        <!-- Daily Reports Section (Admin Only) -->
        <div id="reportsSection" class="hidden admin-only">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-calendar-day text-turquoise-600 mr-2"></i>
                    Günlük Raporlar
                </h2>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Rapor Tarihi</label>
                    <input type="date" id="reportDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-turquoise-500 focus:border-turquoise-500">
                </div>
                
                <div id="dailyReportContent" class="border border-gray-200 rounded-lg p-6 hidden">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Günlük Rapor - <span id="reportDateDisplay"></span></h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-medium text-green-800">Toplam Başvuru</h4>
                            <p class="text-2xl font-bold text-green-600" id="reportTotal">0</p>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h4 class="font-medium text-yellow-800">Acil Durumlar</h4>
                            <p class="text-2xl font-bold text-yellow-600" id="reportUrgent">0</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-medium text-blue-800">En Çok İhtiyaç</h4>
                            <p class="text-lg font-medium text-blue-600" id="reportTopNeed">-</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-medium text-gray-900 mb-2">İhtiyaç Dağılımı</h4>
                        <div id="reportNeedsChart" class="space-y-2">
                            <!-- Will be populated -->
                        </div>
                    </div>
                    
                    <button id="exportReportBtn" class="bg-turquoise-600 text-white px-4 py-2 rounded-lg hover:bg-turquoise-700">
                        <i class="fas fa-download mr-2"></i>Raporu İndir (.CSV)
                    </button>
                </div>
                
                <div id="noReportData" class="text-center py-8 text-gray-500 hidden">
                    <i class="fas fa-file-alt text-4xl mb-4 text-gray-300"></i>
                    <p>Seçilen tarih için rapor verisi bulunmamaktadır.</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-300">
                © <span id="currentYear"></span> Ataşehir Valilik Roman Koordinatörlüğü - 
                Dezavantajlı Roman Halkı Destek Platformu
            </p>
            <p class="text-gray-400 mt-2 text-sm">
                Tüm hakları saklıdır. Bu platform, yardım ihtiyaçlarını daha etkin yönetmek için oluşturulmuştur.
            </p>
        </div>
    </footer>

    <script>
        // Set current year
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Fixed admin password
        const ADMIN_PASSWORD = "2025Bjk2025.,.";
        
        // Firebase configuration - YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyC0qeYrGc7fux8Ym4eEilnG7HMuOWsRigk",
            authDomain: "atasehir-roman-koordinatoru.firebaseapp.com",
            databaseURL: "https://atasehir-roman-koordinatoru-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "atasehir-roman-koordinatoru",
            storageBucket: "atasehir-roman-koordinatoru.firebasestorage.app",
            messagingSenderId: "1090340718017",
            appId: "1:1090340718017:web:52980a10227508eec5db40"
        };

        // Initialize Firebase
        let firebaseApp = null;
        let database = null;
        let submissions = [];
        
        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (error) {
            console.log("Firebase initialization error:", error);
        }

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Check for saved theme preference or respect OS preference
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun text-yellow-400"></i>';
        } else {
            themeToggle.innerHTML = '<i class="fas fa-moon text-gray-600"></i>';
        }
        
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            if (body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun text-yellow-400"></i>';
            } else {
                localStorage.setItem('theme', 'light');
                themeToggle.innerHTML = '<i class="fas fa-moon text-gray-600"></i>';
            }
        });

        // Admin login functionality
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const adminPasswordInput = document.getElementById('adminPassword');
        
        adminLoginBtn.addEventListener('click', () => {
            adminLoginModal.classList.remove('hidden');
        });
        
        closeLoginModal.addEventListener('click', () => {
            adminLoginModal.classList.add('hidden');
            adminPasswordInput.value = '';
        });
        
        // Login with fixed password
        adminLoginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const password = adminPasswordInput.value;
            
            if (password === ADMIN_PASSWORD) {
                // Show admin sections
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.classList.add('admin-visible');
                });
                
                // Show admin navigation tabs
                document.querySelectorAll('.nav-link[data-tab="submissions"], .nav-link[data-tab="stats"], .nav-link[data-tab="management"], .nav-link[data-tab="reports"]').forEach(el => {
                    el.classList.remove('hidden');
                });
                
                adminLoginModal.classList.add('hidden');
                adminPasswordInput.value = '';
                
                // Show logout option
                adminLoginBtn.innerHTML = '<i class="fas fa-sign-out-alt text-red-600"></i>';
                adminLoginBtn.title = 'Çıkış Yap';
                adminLoginBtn.onclick = logoutAdmin;
                
                // Load admin data
                loadSubmissionsFromFirebase();
            } else {
                alert('Geçersiz şifre!');
            }
        });
        
        function logoutAdmin() {
            // Hide admin sections
            document.querySelectorAll('.admin-only').forEach(el => {
                el.classList.remove('admin-visible');
            });
            
            // Hide admin navigation tabs
            document.querySelectorAll('.nav-link[data-tab="submissions"], .nav-link[data-tab="stats"], .nav-link[data-tab="management"], .nav-link[data-tab="reports"]').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Reset navigation to form tab
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active', 'border-turquoise-500', 'text-turquoise-600'));
            document.querySelector('.nav-link[data-tab="form"]').classList.add('active', 'border-turquoise-500', 'text-turquoise-600');
            document.getElementById('formSection').classList.remove('hidden');
            document.getElementById('submissionsSection').classList.add('hidden');
            document.getElementById('statsSection').classList.add('hidden');
            document.getElementById('managementSection').classList.add('hidden');
            document.getElementById('reportsSection').classList.add('hidden');
            
            // Reset admin button
            adminLoginBtn.innerHTML = '<i class="fas fa-lock text-turquoise-600"></i>';
            adminLoginBtn.title = 'Yönetici Girişi';
            adminLoginBtn.onclick = () => adminLoginModal.classList.remove('hidden');
        }

        // Navigation tabs
        const navLinks = document.querySelectorAll('.nav-link');
        
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                navLinks.forEach(l => l.classList.remove('active', 'border-turquoise-500', 'text-turquoise-600'));
                link.classList.add('active', 'border-turquoise-500', 'text-turquoise-600');
                
                // Hide all sections
                document.getElementById('formSection').classList.add('hidden');
                document.getElementById('submissionsSection').classList.add('hidden');
                document.getElementById('statsSection').classList.add('hidden');
                document.getElementById('managementSection').classList.add('hidden');
                document.getElementById('reportsSection').classList.add('hidden');
                
                // Show selected section
                if (link.dataset.tab === 'form') {
                    document.getElementById('formSection').classList.remove('hidden');
                } else if (link.dataset.tab === 'submissions') {
                    document.getElementById('submissionsSection').classList.remove('hidden');
                    loadSubmissionsFromFirebase();
                } else if (link.dataset.tab === 'stats') {
                    document.getElementById('statsSection').classList.remove('hidden');
                    loadSubmissionsFromFirebase().then(() => updateDetailedStats());
                } else if (link.dataset.tab === 'management') {
                    document.getElementById('managementSection').classList.remove('hidden');
                    loadSubmissionsFromFirebase().then(() => updateStats());
                } else if (link.dataset.tab === 'reports') {
                    document.getElementById('reportsSection').classList.remove('hidden');
                    setupReportDate();
                }
            });
        });

        // Load submissions from Firebase
        async function loadSubmissionsFromFirebase() {
            if (!database) {
                return;
            }
            
            try {
                const snapshot = await database.ref('submissions').once('value');
                submissions = snapshot.val() || [];
                if (!Array.isArray(submissions)) {
                    submissions = [];
                }
                updateAllViews();
            } catch (error) {
                console.error("Error loading from Firebase:", error);
            }
        }

        function updateAllViews() {
            updateStats();
            if (document.getElementById('submissionsSection').classList.contains('admin-visible')) {
                loadSubmissionsList();
            }
            if (document.getElementById('statsSection').classList.contains('admin-visible')) {
                updateDetailedStats();
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('totalSubmissions').textContent = submissions.length;
            document.getElementById('submissionsCount').textContent = submissions.length;
            
            const today = new Date().toDateString();
            const todayCount = submissions.filter(sub => new Date(sub.timestamp).toDateString() === today).length;
            document.getElementById('todaySubmissions').textContent = todayCount;
            
            const urgentCount = submissions.filter(sub => sub.urgency === 'urgent').length;
            document.getElementById('urgentSubmissions').textContent = urgentCount;
            
            // Update export buttons
            const exportBtn = document.getElementById('exportBtn');
            const exportBtnManagement = document.getElementById('exportBtnManagement');
            const isDisabled = submissions.length === 0;
            exportBtn.disabled = isDisabled;
            exportBtnManagement.disabled = isDisabled;
            
            document.getElementById('noSubmissions').classList.toggle('hidden', submissions.length > 0);
        }

        // Handle form submission
        document.getElementById('needsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            if (!name || !phone) {
                document.getElementById('errorMessage').classList.remove('hidden');
                setTimeout(() => document.getElementById('errorMessage').classList.add('hidden'), 3000);
                return;
            }
            
            // Get selected needs
            const needsCheckboxes = document.querySelectorAll('input[name="needs"]:checked');
            const needs = {};
            needsCheckboxes.forEach(checkbox => {
                needs[checkbox.value] = true;
            });
            
            // Get other need if applicable
            const otherNeed = needs.other ? document.getElementById('otherNeed').value.trim() : '';
            
            // Get urgency
            const urgency = document.querySelector('input[name="urgency"]:checked').value;
            
            // Get description
            const description = document.getElementById('description').value.trim();
            
            // Get address and district
            const address = document.getElementById('address').value.trim();
            const district = document.getElementById('district').value.trim();
            
            const newSubmission = {
                id: Date.now(),
                name: name,
                phone: phone,
                address: address,
                district: district,
                needs: needs,
                otherNeed: otherNeed,
                urgency: urgency,
                description: description,
                timestamp: new Date().toLocaleString('tr-TR')
            };
            
            // Save to Firebase
            saveSubmissionToFirebase(newSubmission);
            
            // Reset form
            document.getElementById('needsForm').reset();
            document.getElementById('otherNeedContainer').classList.add('hidden');
            
            // Show success message
            document.getElementById('successMessage').classList.remove('hidden');
            setTimeout(() => document.getElementById('successMessage').classList.add('hidden'), 3000);
        });
        
        // Save submission to Firebase
        async function saveSubmissionToFirebase(submission) {
            if (!database) {
                return;
            }
            
            try {
                // Get current submissions
                const snapshot = await database.ref('submissions').once('value');
                let currentSubmissions = snapshot.val() || [];
                if (!Array.isArray(currentSubmissions)) {
                    currentSubmissions = [];
                }
                
                // Add new submission
                currentSubmissions.push(submission);
                
                // Save back to Firebase
                await database.ref('submissions').set(currentSubmissions);
                
                // Update local submissions
                submissions = currentSubmissions;
                updateStats();
            } catch (error) {
                console.error("Error saving to Firebase:", error);
            }
        }
        
        // Handle "Diğer" checkbox
        const otherCheckbox = document.querySelector('input[value="other"]');
        if (otherCheckbox) {
            otherCheckbox.addEventListener('change', function() {
                const otherNeedContainer = document.getElementById('otherNeedContainer');
                if (this.checked) {
                    otherNeedContainer.classList.remove('hidden');
                } else {
                    otherNeedContainer.classList.add('hidden');
                }
            });
        }
        
        // Export to CSV (main section)
        document.getElementById('exportBtn').addEventListener('click', exportToCSV);
        
        // Export to CSV (management section)
        document.getElementById('exportBtnManagement').addEventListener('click', exportToCSV);
        
        function exportToCSV() {
            if (submissions.length === 0) return;
            
            const headers = [
                'Ad Soyad',
                'Telefon',
                'Adres',
                'Mahalle',
                'Gıda',
                'Sağlık',
                'Eğitim',
                'Barınma',
                'İstihdam',
                'Hukuk',
                'Diğer',
                'Diğer İhtiyaç',
                'Aciliyet',
                'Açıklama',
                'Tarih'
            ];
            
            const csvContent = [
                headers.join(','),
                ...submissions.map(sub => [
                    `"${sub.name}"`,
                    `"${sub.phone}"`,
                    `"${sub.address}"`,
                    `"${sub.district}"`,
                    sub.needs.food ? 'Evet' : 'Hayır',
                    sub.needs.health ? 'Evet' : 'Hayır',
                    sub.needs.education ? 'Evet' : 'Hayır',
                    sub.needs.housing ? 'Evet' : 'Hayır',
                    sub.needs.employment ? 'Evet' : 'Hayır',
                    sub.needs.legal ? 'Evet' : 'Hayır',
                    sub.needs.other ? 'Evet' : 'Hayır',
                    `"${sub.otherNeed || ''}"`,
                    sub.urgency === 'urgent' ? 'Acil' : sub.urgency === 'high' ? 'Yüksek' : 'Normal',
                    `"${sub.description}"`,
                    `"${sub.timestamp}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `roman_ihtiyaclari_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Clear all data
        document.getElementById('clearDataBtn').addEventListener('click', function() {
            if (confirm('Tüm verileri silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
                if (confirm('Son kez onaylıyor musunuz? Tüm başvuru kayıtları kalıcı olarak silinecek!')) {
                    clearAllData();
                }
            }
        });
        
        async function clearAllData() {
            if (!database) {
                return;
            }
            
            try {
                await database.ref('submissions').set([]);
                submissions = [];
                updateAllViews();
                alert('Tüm veriler başarıyla silindi!');
            } catch (error) {
                console.error("Error clearing data:", error);
            }
        }
        
        // Load submissions list with filtering
        function loadSubmissionsList() {
            const submissionsList = document.getElementById('submissionsList');
            submissionsList.innerHTML = '';
            
            if (submissions.length === 0) {
                document.getElementById('noSubmissions').classList.remove('hidden');
                return;
            }
            
            document.getElementById('noSubmissions').classList.add('hidden');
            
            // Apply filters
            let filteredSubmissions = [...submissions];
            
            const urgencyFilter = document.getElementById('filterUrgency').value;
            const needFilter = document.getElementById('filterNeed').value;
            
            if (urgencyFilter !== 'all') {
                filteredSubmissions = filteredSubmissions.filter(sub => sub.urgency === urgencyFilter);
            }
            
            if (needFilter !== 'all') {
                filteredSubmissions = filteredSubmissions.filter(sub => sub.needs[needFilter]);
            }
            
            // Sort by timestamp (newest first)
            const sortedSubmissions = filteredSubmissions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            sortedSubmissions.forEach(sub => {
                const urgencyColors = {
                    normal: 'bg-green-100 text-green-800',
                    high: 'bg-yellow-100 text-yellow-800',
                    urgent: 'bg-red-100 text-red-800'
                };
                
                const urgencyLabels = {
                    normal: 'Normal',
                    high: 'Yüksek',
                    urgent: 'Acil'
                };
                
                const needsList = [];
                if (sub.needs.food) needsList.push('Gıda');
                if (sub.needs.health) needsList.push('Sağlık');
                if (sub.needs.education) needsList.push('Eğitim');
                if (sub.needs.housing) needsList.push('Barınma');
                if (sub.needs.employment) needsList.push('İstihdam');
                if (sub.needs.legal) needsList.push('Hukuk');
                if (sub.needs.other) needsList.push('Diğer');
                
                const submissionElement = document.createElement('div');
                submissionElement.className = 'border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow';
                submissionElement.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-gray-900">${sub.name}</h3>
                            <p class="text-sm text-gray-600">${sub.phone}</p>
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${urgencyColors[sub.urgency]}">
                            ${urgencyLabels[sub.urgency]}
                        </span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                        <div>
                            <p class="text-sm text-gray-600"><i class="fas fa-map-marker-alt mr-2"></i>${sub.address || 'Adres belirtilmemiş'}</p>
                            <p class="text-sm text-gray-600"><i class="fas fa-city mr-2"></i>${sub.district || 'Mahalle belirtilmemiş'}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600"><i class="fas fa-list mr-2"></i>${needsList.join(', ')}</p>
                            ${sub.otherNeed ? `<p class="text-sm text-gray-600"><i class="fas fa-plus mr-2"></i>${sub.otherNeed}</p>` : ''}
                        </div>
                    </div>
                    ${sub.description ? `<p class="text-sm text-gray-700 mb-2">${sub.description}</p>` : ''}
                    <p class="text-xs text-gray-500"><i class="fas fa-clock mr-2"></i>${sub.timestamp}</p>
                `;
                
                submissionsList.appendChild(submissionElement);
            });
        }
        
        // Apply filters
        document.getElementById('applyFilters').addEventListener('click', loadSubmissionsList);
        
        // Update detailed statistics
        function updateDetailedStats() {
            // Needs distribution
            const needsDistribution = document.getElementById('needsDistribution');
            needsDistribution.innerHTML = '';
            
            const needsCount = {
                food: 0,
                health: 0,
                education: 0,
                housing: 0,
                employment: 0,
                legal: 0,
                other: 0
            };
            
            submissions.forEach(sub => {
                Object.keys(needsCount).forEach(need => {
                    if (sub.needs[need]) {
                        needsCount[need]++;
                    }
                });
            });
            
            const needsLabels = {
                food: 'Gıda',
                health: 'Sağlık',
                education: 'Eğitim',
                housing: 'Barınma',
                employment: 'İstihdam',
                legal: 'Hukuk',
                other: 'Diğer'
            };
            
            Object.entries(needsCount).forEach(([key, count]) => {
                if (count > 0) {
                    const percentage = submissions.length > 0 ? Math.round((count / submissions.length) * 100) : 0;
                    const barElement = document.createElement('div');
                    barElement.className = 'flex items-center justify-between';
                    barElement.innerHTML = `
                        <span class="text-sm font-medium">${needsLabels[key]}</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-turquoise-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${count} (${percentage}%)</span>
                        </div>
                    `;
                    needsDistribution.appendChild(barElement);
                }
            });
            
            // Urgency distribution
            const urgencyDistribution = document.getElementById('urgencyDistribution');
            urgencyDistribution.innerHTML = '';
            
            const urgencyCount = { normal: 0, high: 0, urgent: 0 };
            submissions.forEach(sub => {
                urgencyCount[sub.urgency]++;
            });
            
            const urgencyLabels = { normal: 'Normal', high: 'Yüksek', urgent: 'Acil' };
            const urgencyColors = { normal: 'bg-green-500', high: 'bg-yellow-500', urgent: 'bg-red-500' };
            
            Object.entries(urgencyCount).forEach(([key, count]) => {
                if (count > 0) {
                    const percentage = submissions.length > 0 ? Math.round((count / submissions.length) * 100) : 0;
                    const barElement = document.createElement('div');
                    barElement.className = 'flex items-center justify-between';
                    barElement.innerHTML = `
                        <span class="text-sm font-medium">${urgencyLabels[key]}</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="${urgencyColors[key]} h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${count} (${percentage}%)</span>
                        </div>
                    `;
                    urgencyDistribution.appendChild(barElement);
                }
            });
            
            // Daily submissions (last 7 days)
            const dailySubmissions = document.getElementById('dailySubmissions');
            dailySubmissions.innerHTML = '';
            
            const today = new Date();
            const dailyCount = {};
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                dailyCount[dateStr] = 0;
            }
            
            submissions.forEach(sub => {
                const subDate = new Date(sub.timestamp);
                const subDateStr = subDate.toISOString().split('T')[0];
                if (dailyCount[subDateStr] !== undefined) {
                    dailyCount[subDateStr]++;
                }
            });
            
            Object.entries(dailyCount).forEach(([date, count]) => {
                const dateObj = new Date(date);
                const dayNames = ['Paz', 'Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cmt'];
                const dayName = dayNames[dateObj.getDay()];
                const formattedDate = `${dayName} ${date.split('-')[2]}`;
                
                const barElement = document.createElement('div');
                barElement.className = 'flex items-center justify-between';
                barElement.innerHTML = `
                    <span class="text-sm font-medium">${formattedDate}</span>
                    <span class="text-sm text-gray-600">${count}</span>
                `;
                dailySubmissions.appendChild(barElement);
            });
        }
        
        // Refresh submissions
        document.getElementById('refreshSubmissions').addEventListener('click', () => {
            loadSubmissionsFromFirebase();
        });
        
        // Setup report date
        function setupReportDate() {
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            document.getElementById('reportDate').value = dateString;
            generateDailyReport(dateString);
            
            document.getElementById('reportDate').addEventListener('change', (e) => {
                generateDailyReport(e.target.value);
            });
        }
        
        // Generate daily report
        function generateDailyReport(dateString) {
            if (!dateString) return;
            
            const reportDate = new Date(dateString);
            const reportDateStr = reportDate.toISOString().split('T')[0];
            
            // Filter submissions for the selected date
            const dailySubmissions = submissions.filter(sub => {
                const subDate = new Date(sub.timestamp);
                return subDate.toISOString().split('T')[0] === reportDateStr;
            });
            
            const dailyReportContent = document.getElementById('dailyReportContent');
            const noReportData = document.getElementById('noReportData');
            
            if (dailySubmissions.length === 0) {
                dailyReportContent.classList.add('hidden');
                noReportData.classList.remove('hidden');
                return;
            }
            
            noReportData.classList.add('hidden');
            dailyReportContent.classList.remove('hidden');
            
            // Format date for display
            const dayNames = ['Pazar', 'Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi'];
            const monthNames = ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'];
            const displayDate = `${dayNames[reportDate.getDay()]}, ${reportDate.getDate()} ${monthNames[reportDate.getMonth()]} ${reportDate.getFullYear()}`;
            
            document.getElementById('reportDateDisplay').textContent = displayDate;
            document.getElementById('reportTotal').textContent = dailySubmissions.length;
            
            // Count urgent submissions
            const urgentCount = dailySubmissions.filter(sub => sub.urgency === 'urgent').length;
            document.getElementById('reportUrgent').textContent = urgentCount;
            
            // Find top need
            const needsCount = { food: 0, health: 0, education: 0, housing: 0, employment: 0, legal: 0, other: 0 };
            dailySubmissions.forEach(sub => {
                Object.keys(needsCount).forEach(need => {
                    if (sub.needs[need]) {
                        needsCount[need]++;
                    }
                });
            });
            
            const needsLabels = { food: 'Gıda', health: 'Sağlık', education: 'Eğitim', housing: 'Barınma', employment: 'İstihdam', legal: 'Hukuk', other: 'Diğer' };
            const topNeed = Object.entries(needsCount).reduce((a, b) => needsCount[a[0]] > needsCount[b[0]] ? a : b);
            document.getElementById('reportTopNeed').textContent = needsCount[topNeed[0]] > 0 ? needsLabels[topNeed[0]] : '-';
            
            // Generate needs chart for report
            const reportNeedsChart = document.getElementById('reportNeedsChart');
            reportNeedsChart.innerHTML = '';
            
            Object.entries(needsCount).forEach(([key, count]) => {
                if (count > 0) {
                    const percentage = Math.round((count / dailySubmissions.length) * 100);
                    const barElement = document.createElement('div');
                    barElement.className = 'flex items-center justify-between';
                    barElement.innerHTML = `
                        <span class="text-sm font-medium">${needsLabels[key]}</span>
                        <div class="flex items-center space-x-2">
                            <div class="w-24 bg-gray-200 rounded-full h-2">
                                <div class="bg-turquoise-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                            <span class="text-sm text-gray-600">${count} (${percentage}%)</span>
                        </div>
                    `;
                    reportNeedsChart.appendChild(barElement);
                }
            });
        }
        
        // Export daily report
        document.getElementById('exportReportBtn').addEventListener('click', function() {
            const reportDate = document.getElementById('reportDate').value;
            if (!reportDate) return;
            
            const reportDateObj = new Date(reportDate);
            const dailySubmissions = submissions.filter(sub => {
                const subDate = new Date(sub.timestamp);
                return subDate.toISOString().split('T')[0] === reportDate;
            });
            
            if (dailySubmissions.length === 0) return;
            
            const headers = [
                'Ad Soyad',
                'Telefon',
                'Adres',
                'Mahalle',
                'Gıda',
                'Sağlık',
                'Eğitim',
                'Barınma',
                'İstihdam',
                'Hukuk',
                'Diğer',
                'Diğer İhtiyaç',
                'Aciliyet',
                'Açıklama',
                'Tarih'
            ];
            
            const csvContent = [
                headers.join(','),
                ...dailySubmissions.map(sub => [
                    `"${sub.name}"`,
                    `"${sub.phone}"`,
                    `"${sub.address}"`,
                    `"${sub.district}"`,
                    sub.needs.food ? 'Evet' : 'Hayır',
                    sub.needs.health ? 'Evet' : 'Hayır',
                    sub.needs.education ? 'Evet' : 'Hayır',
                    sub.needs.housing ? 'Evet' : 'Hayır',
                    sub.needs.employment ? 'Evet' : 'Hayır',
                    sub.needs.legal ? 'Evet' : 'Hayır',
                    sub.needs.other ? 'Evet' : 'Hayır',
                    `"${sub.otherNeed || ''}"`,
                    sub.urgency === 'urgent' ? 'Acil' : sub.urgency === 'high' ? 'Yüksek' : 'Normal',
                    `"${sub.description}"`,
                    `"${sub.timestamp}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `roman_gunluk_rapor_${reportDate}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // Initialize stats on page load
        loadSubmissionsFromFirebase();
        
        // Set first tab as active
        document.querySelector('.nav-link[data-tab="form"]').classList.add('active', 'border-turquoise-500', 'text-turquoise-600');
    </script>
</body>
</html>